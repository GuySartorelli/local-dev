#!/bin/bash

# Based on https://gist.github.com/maxime-rainville/0e2cc280cc9d2e014a21b55a192076d9

# Define a few constants
git_prefix="git@github.com:"
http_prefix="https://github.com/"
cc_account="git@github.com:creative-commoners/"
security_account="git@github.com:silverstripe-security/"

# Get our url for our origin remote
origin_url=`git remote get-url origin`

if [[ $origin_url =~ ^${http_prefix}* ]]
then
    git remote rename origin orig
    git remote add cc ${origin_url/$http_prefix*\//$cc_account}
    git remote add security ${origin_url/$http_prefix*\//$security_account}
    git fetch --all
elif [[ $origin_url =~ ^${git_prefix}* ]]
then
    git remote rename origin orig
    git remote add cc ${origin_url/$git_prefix*\//$cc_account}
    git remote add security ${origin_url/$git_prefix*\//$security_account}
    git fetch --all
else
    echo "Origin $origin_url does not appear to be valid"
    exit 1
fi

echo "Remotes added and fetched"
